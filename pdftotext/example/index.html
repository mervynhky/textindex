<html>
<head>
    <meta charset="utf-8">
    <title>Converting PDF To Text using pdf.js</title>
    <link rel="stylesheet" type="text/css" href="assets/reset.css" />
    <link rel="stylesheet" type="text/css" href="assets/styles.css" />
    <link rel="stylesheet" type="text/css" href="assets/github.css" />
    <link rel="stylesheet" type="text/css" href="assets/ColorPicker.css" />
    <script type="text/javascript" src="assets/rainbow-custom.min.js"></script>
    <script type="text/javascript" src="assets/ColorPicker.js"></script>
    <script src="../../2011/11/pdftotext/jQuery-1.7.js"></script>
    <style>
        html, body {
            width: 100%;
            height: 100%;
            overflow-y: hidden;
            padding: 0;
            margin: 0;
        }

        body {
            font: 13px Helvetica, sans-serif;
        }

        body > div {
            width: 48%;
            height: 100%;
            overflow-y: auto;
            display: inline-block;
            vertical-align: top;
        }

        iframe {
            border: none;
            width: 100%;
            height: 100%;
        }

        #output {
            padding: 10px;
            box-shadow: 0 0 5px #777;
            border-radius: 5px;
            margin: 10px;
        }

        #processor {
            height: 70px;
        }
    </style>
</head>

<body>
<div>
    <!-- embed the pdftotext web app as an iframe -->
    <iframe id="processor" src="../"></iframe>

    Change highlighting color: <div class="color-picker"></div>
    Remove all highlights: <button id="remove">Remove</button>

    <button style="margin-left:10px;" id="clearPg" onclick="clearPg();">Clear Page</button>
    <!-- a container for the output -->
    <div id="output">
        <div id="intro"></div>
    </div>
</div>
<!--UP IS LEFT, DOWN IS RIGHT-->
<div>
    <!-- the PDF file must be on the same domain as this page -->
    <iframe id="input" src="journal.pone.0026738.pdf"></iframe>
</div>
<!--<script src="../../2011/11/pdftotext/jQuery-1.7.js"></script>-->
<script src="TextHighlighter.min.js"></script>
<script type="text/javascript">

    function clearPg(){
        var jqDiv = document.getElementById("output");
        jqDiv.innerHTML = "";
        jqDiv.textContent = "";
    }


    (function () {
        var removeBtn = document.getElementById('remove');
        var sandbox = document.getElementById('output');
        var colors = new ColorPicker(document.querySelector('.color-picker'));
        var hltr = new TextHighlighter(sandbox);

        colors.onColorChange(function (color) {
            hltr.setColor(color);
        });

        removeBtn.addEventListener('click', function () {
            hltr.removeHighlights();
        });
    })();

</script>
<script>
    var input = document.getElementById("input");
    var processor = document.getElementById("processor");
    var output = document.getElementById("output");

    window.addEventListener("message", function (event) {
        if (event.source != processor.contentWindow) return;

        switch (event.data) {
            case "ready":
                var xhr = new XMLHttpRequest;
                xhr.open('GET', input.getAttribute("src"), true);
                xhr.responseType = "arraybuffer";

                xhr.onload = function (event) {
                    processor.contentWindow.postMessage(this.response, "*");
                };

                xhr.send();
                break;

            default:
                output.textContent = event.data.replace(/\s+/g, " ");
                break;
        }
    }, true);
</script>
</body>
</html>
